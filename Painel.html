<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LAB-NEXUS | Bunker Digital C137</title>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@600;700&family=Inter:wght@300;400;600&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        :root {
            --gold: #C5A059;
            --gold-glow: rgba(197, 160, 89, 0.3);
            --bg: #020202;
            --surface: rgba(20, 20, 20, 0.95);
            --cyan: #00F2FF;
            --paper: #fdfdfd;
            --glass: blur(12px) saturate(160%);
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        
        body {
            background: var(--bg);
            color: #fff;
            font-family: 'Inter', sans-serif;
            margin: 0;
            height: 100vh;
            overflow: hidden;
            background-image: radial-gradient(circle at 0% 0%, rgba(197, 160, 89, 0.08) 0%, transparent 50%);
        }

        /* --- HEADER --- */
        header {
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .balance-box {
            background: var(--surface);
            padding: 8px 15px;
            border-radius: 10px;
            border: 1px solid var(--gold-glow);
            font-family: 'JetBrains Mono';
        }

        /* --- CATALOGO GRID --- */
        #catalog-view {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            padding-bottom: 120px;
        }

        .cat-card {
            background: var(--surface);
            backdrop-filter: var(--glass);
            border: 1px solid rgba(255,255,255,0.05);
            border-radius: 20px;
            padding: 25px 15px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .cat-card:active { transform: scale(0.95); background: rgba(197, 160, 89, 0.1); }
        .cat-card i { font-size: 1.8rem; display: block; margin-bottom: 10px; }
        .cat-card span { font-size: 0.65rem; font-weight: 700; color: var(--gold); letter-spacing: 1px; }

        /* --- MODAL FORMUL√ÅRIO --- */
        #form-view {
            position: fixed;
            inset: 0;
            background: var(--bg);
            z-index: 1000;
            display: none;
            flex-direction: column;
            padding: 20px;
            animation: slideUp 0.4s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .form-header { display: flex; justify-content: space-between; margin-bottom: 25px; }
        
        .input-group { margin-bottom: 15px; }
        label { display: block; font-size: 0.6rem; color: var(--gold); margin-bottom: 6px; letter-spacing: 1px; }
        input, textarea {
            width: 100%; background: #111; border: 1px solid #333;
            padding: 15px; color: #fff; border-radius: 10px; font-family: inherit;
        }

        /* --- VISUALIZADOR DE PAPEL --- */
        #paper-preview-modal {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.98);
            z-index: 2000;
            display: none;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .paper-document {
            width: 100%;
            max-width: 800px;
            background: var(--paper);
            color: #1a1a1a;
            padding: 60px 40px;
            box-shadow: 0 0 60px rgba(0,0,0,0.5);
            font-family: 'Times New Roman', serif;
            min-height: 1000px;
            position: relative;
        }

        .ancestry-link {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.65rem;
            background: #eee;
            padding: 12px;
            border: 1px dashed #999;
            margin-bottom: 30px;
            color: #444;
        }

        /* --- TOAST --- */
        #toast {
            position: fixed;
            top: 30px; left: 50%; transform: translateX(-50%);
            background: var(--gold); color: #000; padding: 12px 25px;
            border-radius: 50px; font-weight: bold; font-size: 0.8rem;
            z-index: 3000; display: none; box-shadow: 0 10px 30px rgba(197, 160, 89, 0.4);
        }

        /* --- TAB BAR --- */
        .tab-bar {
            position: fixed; bottom: 25px; left: 50%; transform: translateX(-50%);
            width: 90%; height: 65px; background: rgba(15, 15, 15, 0.9);
            backdrop-filter: var(--glass); border-radius: 35px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex; justify-content: space-around; align-items: center; z-index: 500;
        }

        .btn-action {
            background: var(--gold); color: #000; border: none;
            padding: 18px; border-radius: 15px; font-family: 'Cinzel';
            font-weight: 700; cursor: pointer; letter-spacing: 2px;
        }

        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

<div id="toast">Notifica√ß√£o</div>

<header>
    <div class="balance-box">
        <small style="color:var(--gold); display:block; font-size: 9px; letter-spacing: 1px;">SATS NO BUNKER</small>
        <span id="sat-count">1.240.500</span>
    </div>
    <div style="font-family: 'Cinzel'; font-size: 1.2rem; color: var(--gold);">LAB-NEXUS</div>
</header>

<main id="catalog-view">
    </main>

<div id="form-view">
    <div class="form-header">
        <h2 id="form-title" style="font-family:'Cinzel'; color:var(--gold); margin:0;">CONTRATO</h2>
        <button onclick="closeForm()" style="background:none; border:none; color:#555; font-size:24px;">‚úï</button>
    </div>
    <div id="form-fields" style="flex:1; overflow-y:auto; padding-bottom:100px;"></div>
    
    <div style="position:fixed; bottom:20px; left:20px; right:20px;">
        <button class="btn-action" style="width:100%" onclick="openPaperPreview()">REVISAR ESCRITURA üìú</button>
    </div>
</div>

<div id="paper-preview-modal">
    <div class="paper-document" id="paper-content">
        <div style="text-align:center; border-bottom: 2px solid #000; margin-bottom:40px; padding-bottom:10px;">
            <h1 style="font-family:'Cinzel'; margin:0; font-size: 1.8rem;">CART√ìRIO DIGITAL C137</h1>
            <p style="letter-spacing:3px; font-size:0.7rem;">INSTITUI√á√ÉO SOBERANA DE REGISTROS</p>
        </div>
        
        <div id="ancestry-tag"></div>
        <div id="rendered-body" style="line-height:1.7; text-align:justify; color:#222;"></div>
        
        <div style="margin-top:80px; border-top: 1px solid #ddd; padding-top:20px; font-family:'JetBrains Mono'; font-size:11px; color:#666;">
            HASH SHA-256: <span id="doc-hash">...</span><br>
            STATUS: AGUARDANDO SELAGEM TERMODIN√ÇMICA
        </div>
    </div>

    <div style="margin: 30px 0; display:flex; gap:15px; padding-bottom:60px;">
        <button class="btn-action" style="background:#222; color:#fff;" onclick="closePreview()">EDITAR</button>
        <button class="btn-action" onclick="sealAndPay()">SELAR & PAGAR ‚ö°</button>
    </div>
</div>

<nav class="tab-bar">
    <div style="color:var(--gold); font-size:1.2rem;">üèõÔ∏è</div>
    <div style="color:#444; font-size:1.2rem;">üìú</div>
    <div style="color:#444; font-size:1.2rem;">üîê</div>
</nav>

<script>
    // --- 1. CONFIGURA√á√ÉO MODULAR (CATEGORIAS E CAMPOS) ---
    const MODULES = {
        locacao: { title: "Contrato de Loca√ß√£o", icon: "üè†", fields: ["Nome Completo", "CPF", "DID", "Descri√ß√£o do Im√≥vel", "Valor Mensal (Sats)", "Validade", "Cl√°usulas"] },
        nascimento: { title: "Registro de Nascimento", icon: "üßæ", fields: ["Rec√©m-Nascido", "Pai", "M√£e", "Data e Hora", "Hospital/Local"] },
        notas: { title: "Escritura P√∫blica", icon: "üèõÔ∏è", fields: ["Tipo de Ato", "Partes", "Objeto", "Valor total", "Cl√°usulas Finais"] },
        ata: { title: "Ata Notarial", icon: "üîê", fields: ["Fato Observado", "URL/Fonte", "Geolocaliza√ß√£o", "Data"] },
        imoveis: { title: "Registro de Im√≥veis", icon: "üè¢", fields: ["Matr√≠cula", "Propriet√°rio", "√Årea Total", "Gravames"] },
        maritimo: { title: "Contrato Mar√≠timo", icon: "‚öì", fields: ["Embarca√ß√£o", "Nacionalidade", "Carga", "Porto de Destino"] }
    };

    // --- 2. MOTOR DE INTERFACE ---
    function renderCatalog() {
        const grid = document.getElementById('catalog-view');
        grid.innerHTML = Object.keys(MODULES).map(key => `
            <div class="cat-card" onclick="openForm('${key}')">
                <i>${MODULES[key].icon}</i>
                <span>${MODULES[key].title.toUpperCase()}</span>
            </div>
        `).join('');
    }

    function openForm(key) {
        const mod = MODULES[key];
        document.getElementById('form-title').innerText = mod.title;
        const cont = document.getElementById('form-fields');
        
        cont.innerHTML = mod.fields.map(f => `
            <div class="input-group">
                <label>${f.toUpperCase()}</label>
                <input type="text" class="nexus-input-field" placeholder="Digitar dados...">
            </div>
        `).join('');
        
        document.getElementById('form-view').style.display = 'flex';
    }

    function closeForm() { document.getElementById('form-view').style.display = 'none'; }

    // --- 3. VISUALIZADOR E VERSIONAMENTO ---
    async function openPaperPreview() {
        const title = document.getElementById('form-title').innerText;
        const inputs = document.querySelectorAll('.nexus-input-field');
        let bodyHtml = `<h2 style="text-align:center; font-family:'Cinzel';">${title}</h2><br>`;
        
        inputs.forEach(input => {
            const label = input.previousElementSibling.innerText;
            bodyHtml += `<p><strong>${label}:</strong> ${input.value || '________________'}</p>`;
        });

        document.getElementById('rendered-body').innerHTML = bodyHtml;

        // L√≥gica de V√≠nculo (Busca se h√° algo j√° selado)
        const lastHash = localStorage.getItem('c137_last_hash');
        if(lastHash) {
            document.getElementById('ancestry-tag').innerHTML = `
                <div class="ancestry-link">üîó ADITAMENTO: Vinculado ao Ancestral ${lastHash.substring(0,24)}...</div>
            `;
        } else {
            document.getElementById('ancestry-tag').innerHTML = "";
        }

        // Gera√ß√£o de Hash SHA-256 Real
        const encoder = new TextEncoder();
        const data = encoder.encode(bodyHtml);
        const hashBuffer = await crypto.subtle.digest('SHA-256', data);
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
        
        document.getElementById('doc-hash').innerText = hashHex;
        document.getElementById('paper-preview-modal').style.display = 'flex';
    }

    function closePreview() { document.getElementById('paper-preview-modal').style.display = 'none'; }

    // --- 4. RITUAL DE SELAGEM ---
    function sealAndPay() {
        const toast = document.getElementById('toast');
        toast.innerText = "‚ö° SOLICITANDO 1000 SATS VIA LIGHTNING...";
        toast.style.display = "block";

        // Simula√ß√£o de transa√ß√£o Lightning (Integraria com Motor_de_Checkout_Lightning.js)
        setTimeout(() => {
            const finalHash = document.getElementById('doc-hash').innerText;
            localStorage.setItem('c137_last_hash', finalHash);
            
            toast.innerText = "üìú ESCRITURA SELADA NA ETERNIDADE!";
            if (navigator.vibrate) navigator.vibrate([100, 50, 100]);
            
            setTimeout(() => {
                toast.style.display = "none";
                closePreview();
                closeForm();
            }, 2000);
        }, 2000);
    }

    window.onload = renderCatalog;
</script>

</body>
</html>
